#include "nutrig.h"
#include <math.h>

f32 NuTrigTable[NU_TRIG_TABLE_SIZE];

angle ang[UNIT_CIRCLE_PRECISION] = {
	0x0000, 0x0014, 0x0029, 0x003D,
	0x0051, 0x0066, 0x007A, 0x008F,
	0x00A3, 0x00B7, 0x00CC, 0x00E0,
	0x00F4, 0x0109, 0x011D, 0x0131,
	0x0146, 0x015A, 0x016F, 0x0183,
	0x0197, 0x01AC, 0x01C0, 0x01D4,
	0x01E9, 0x01FD, 0x0211, 0x0226,
	0x023A, 0x024E, 0x0262, 0x0277,
	0x028B, 0x029F, 0x02B4, 0x02C8,
	0x02DC, 0x02F0, 0x0305, 0x0319,
	0x032D, 0x0341, 0x0356, 0x036A,
	0x037E, 0x0392, 0x03A7, 0x03BB,
	0x03CF, 0x03E3, 0x03F7, 0x040C,
	0x0420, 0x0434, 0x0448, 0x045C,
	0x0470, 0x0484, 0x0499, 0x04AD,
	0x04C1, 0x04D5, 0x04E9, 0x04FD,
	0x0511, 0x0525, 0x0539, 0x054D,
	0x0561, 0x0575, 0x0589, 0x059D,
	0x05B1, 0x05C5, 0x05D9, 0x05ED,
	0x0601, 0x0615, 0x0629, 0x063D,
	0x0651, 0x0665, 0x0678, 0x068C,
	0x06A0, 0x06B4, 0x06C8, 0x06DC,
	0x06EF, 0x0703, 0x0717, 0x072B,
	0x073E, 0x0752, 0x0766, 0x077A,
	0x078D, 0x07A1, 0x07B5, 0x07C8,
	0x07DC, 0x07EF, 0x0803, 0x0817,
	0x082A, 0x083E, 0x0851, 0x0865,
	0x0878, 0x088C, 0x089F, 0x08B3,
	0x08C6, 0x08DA, 0x08ED, 0x0901,
	0x0914, 0x0927, 0x093B, 0x094E,
	0x0961, 0x0975, 0x0988, 0x099B,
	0x09AE, 0x09C2, 0x09D5, 0x09E8,
	0x09FB, 0x0A0E, 0x0A22, 0x0A35,
	0x0A48, 0x0A5B, 0x0A6E, 0x0A81,
	0x0A94, 0x0AA7, 0x0ABA, 0x0ACD,
	0x0AE0, 0x0AF3, 0x0B06, 0x0B19,
	0x0B2C, 0x0B3F, 0x0B51, 0x0B64,
	0x0B77, 0x0B8A, 0x0B9D, 0x0BAF,
	0x0BC2, 0x0BD5, 0x0BE7, 0x0BFA,
	0x0C0D, 0x0C1F, 0x0C32, 0x0C45,
	0x0C57, 0x0C6A, 0x0C7C, 0x0C8F,
	0x0CA1, 0x0CB4, 0x0CC6, 0x0CD9,
	0x0CEB, 0x0CFD, 0x0D10, 0x0D22,
	0x0D34, 0x0D47, 0x0D59, 0x0D6B,
	0x0D7D, 0x0D90, 0x0DA2, 0x0DB4,
	0x0DC6, 0x0DD8, 0x0DEA, 0x0DFC,
	0x0E0F, 0x0E21, 0x0E33, 0x0E45,
	0x0E56, 0x0E68, 0x0E7A, 0x0E8C,
	0x0E9E, 0x0EB0, 0x0EC2, 0x0ED4,
	0x0EE5, 0x0EF7, 0x0F09, 0x0F1B,
	0x0F2C, 0x0F3E, 0x0F50, 0x0F61,
	0x0F73, 0x0F84, 0x0F96, 0x0FA7,
	0x0FB9, 0x0FCA, 0x0FDC, 0x0FED,
	0x0FFF, 0x1010, 0x1021, 0x1033,
	0x1044, 0x1055, 0x1067, 0x1078,
	0x1089, 0x109A, 0x10AB, 0x10BC,
	0x10CE, 0x10DF, 0x10F0, 0x1101,
	0x1112, 0x1123, 0x1134, 0x1145,
	0x1156, 0x1166, 0x1177, 0x1188,
	0x1199, 0x11AA, 0x11BB, 0x11CB,
	0x11DC, 0x11ED, 0x11FD, 0x120E,
	0x121F, 0x122F, 0x1240, 0x1250,
	0x1261, 0x1271, 0x1282, 0x1292,
	0x12A3, 0x12B3, 0x12C3, 0x12D4,
	0x12E4, 0x12F4, 0x1305, 0x1315,
	0x1325, 0x1335, 0x1345, 0x1355,
	0x1366, 0x1376, 0x1386, 0x1396,
	0x13A6, 0x13B6, 0x13C6, 0x13D6,
	0x13E6, 0x13F5, 0x1405, 0x1415,
	0x1425, 0x1435, 0x1444, 0x1454,
	0x1464, 0x1473, 0x1483, 0x1493,
	0x14A2, 0x14B2, 0x14C1, 0x14D1,
	0x14E0, 0x14F0, 0x14FF, 0x150F,
	0x151E, 0x152D, 0x153D, 0x154C,
	0x155B, 0x156B, 0x157A, 0x1589,
	0x1598, 0x15A7, 0x15B7, 0x15C6,
	0x15D5, 0x15E4, 0x15F3, 0x1602,
	0x1611, 0x1620, 0x162F, 0x163E,
	0x164C, 0x165B, 0x166A, 0x1679,
	0x1688, 0x1696, 0x16A5, 0x16B4,
	0x16C2, 0x16D1, 0x16E0, 0x16EE,
	0x16FD, 0x170B, 0x171A, 0x1728,
	0x1737, 0x1745, 0x1754, 0x1762,
	0x1770, 0x177F, 0x178D, 0x179B,
	0x17AA, 0x17B8, 0x17C6, 0x17D4,
	0x17E2, 0x17F0, 0x17FE, 0x180D,
	0x181B, 0x1829, 0x1837, 0x1845,
	0x1853, 0x1860, 0x186E, 0x187C,
	0x188A, 0x1898, 0x18A6, 0x18B3,
	0x18C1, 0x18CF, 0x18DD, 0x18EA,
	0x18F8, 0x1906, 0x1913, 0x1921,
	0x192E, 0x193C, 0x1949, 0x1957,
	0x1964, 0x1972, 0x197F, 0x198C,
	0x199A, 0x19A7, 0x19B4, 0x19C2,
	0x19CF, 0x19DC, 0x19E9, 0x19F6,
	0x1A04, 0x1A11, 0x1A1E, 0x1A2B,
	0x1A38, 0x1A45, 0x1A52, 0x1A5F,
	0x1A6C, 0x1A79, 0x1A86, 0x1A93,
	0x1A9F, 0x1AAC, 0x1AB9, 0x1AC6,
	0x1AD3, 0x1ADF, 0x1AEC, 0x1AF9,
	0x1B05, 0x1B12, 0x1B1F, 0x1B2B,
	0x1B38, 0x1B44, 0x1B51, 0x1B5D,
	0x1B6A, 0x1B76, 0x1B83, 0x1B8F,
	0x1B9C, 0x1BA8, 0x1BB4, 0x1BC1,
	0x1BCD, 0x1BD9, 0x1BE5, 0x1BF2,
	0x1BFE, 0x1C0A, 0x1C16, 0x1C22,
	0x1C2E, 0x1C3A, 0x1C46, 0x1C52,
	0x1C5E, 0x1C6A, 0x1C76, 0x1C82,
	0x1C8E, 0x1C9A, 0x1CA6, 0x1CB2,
	0x1CBE, 0x1CC9, 0x1CD5, 0x1CE1,
	0x1CED, 0x1CF8, 0x1D04, 0x1D10,
	0x1D1B, 0x1D27, 0x1D33, 0x1D3E,
	0x1D4A, 0x1D55, 0x1D61, 0x1D6C,
	0x1D78, 0x1D83, 0x1D8E, 0x1D9A,
	0x1DA5, 0x1DB1, 0x1DBC, 0x1DC7,
	0x1DD3, 0x1DDE, 0x1DE9, 0x1DF4,
	0x1DFF, 0x1E0B, 0x1E16, 0x1E21,
	0x1E2C, 0x1E37, 0x1E42, 0x1E4D,
	0x1E58, 0x1E63, 0x1E6E, 0x1E79,
	0x1E84, 0x1E8F, 0x1E9A, 0x1EA5,
	0x1EB0, 0x1EBA, 0x1EC5, 0x1ED0,
	0x1EDB, 0x1EE6, 0x1EF0, 0x1EFB,
	0x1F06, 0x1F10, 0x1F1B, 0x1F26,
	0x1F30, 0x1F3B, 0x1F45, 0x1F50,
	0x1F5A, 0x1F65, 0x1F6F, 0x1F7A,
	0x1F84, 0x1F8F, 0x1F99, 0x1FA4,
	0x1FAE, 0x1FB8, 0x1FC3, 0x1FCD,
	0x1FD7, 0x1FE1, 0x1FEC, 0x1FF6,
	0x2000
};


void NuTrigInit()
{
	f32 inc = 0.00009587f;
	for (s32 i = 0; i < NU_TRIG_TABLE_SIZE; i++)
	{
		NuTrigTable[i] = (f32)sin((f64)(i * inc));
		//printf("table: %d\n", NuTrigTable[i]);
	}
}

angle xy(fxi x, fxi y)
{
	return x <= y ? ang[(x << 9) / y] : (PIOV2 - ang[(y << 9) / x]);
}

angle NuAtani(fxi x, fxi y)
{
	angle ret;
	if (x == 0)
	{
		ret = (angle)((u32)y >> 0x10) & PI;
	}
	else
	{
		if (y == 0)
		{
			ret = PIOV2;
			if (x < 0)
			{
				ret = PI3OV2;
			}
		}
		else
		{
			if (x < 0)
			{
				if (y < 0)
				{
					ret = xy(-x, -y);
					ret += PI;
				}
				else
				{
					ret = xy(-x, y);
					ret = -ret;
				}
			}
			else
			{
				if (y < 0)
				{
					ret = xy(x, -y);
					ret = PI - ret;
				}
				else
				{
					ret = xy(x, y);
				}
			}
		}
	}
	return ret;
}

f32 NuAtan2(f32 x, f32 y)
{
	return (f32)atan2(x, y);
}

angle fxyd(f32 x, f32 y)
{
	angle ret;
	if (y < x)
	{
		ret = PIOV2 - ang[(s32)((y * 512.0) / x)];
	}
	else
	{
		ret = ang[(s32)((x * 512.0) / y)];
	}
	return ret;
}

angle NuAtan2D(f32 x, f32 y)
{
	angle ret;
	if (x == 0.0)
	{
		ret = 0;
		if (y < 0.0)
		{
			ret = PI;
		}
	}
	else
	{
		if (y == 0.00) {
			ret = PIOV2;
			if (x < 0.0)
			{
				ret = PI3OV2;
			}
		}
		else {
			if (x >= 0.0)
			{
				if (y < 0.0)
				{
					ret = fxyd(x, -y);
					ret = PI - ret;
				}
				else
				{
					ret = fxyd(x, y);
				}
			}
			else
			{
				if (y < 0.0)
				{
					ret = fxyd(-x, -y);
					ret += PI;
				}
				else
				{
					ret = fxyd(-x, y);
					ret = -ret;
				}
			}
		}
	}
	return ret;
}

angle NuAngleSub(angle a, angle b)
{
	return a - b;
}
